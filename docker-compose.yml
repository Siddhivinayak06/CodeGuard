version: "3.9"

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    image: codeguard-backend
    ports:
      - "5002:5000"
    env_file:
      - .env
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    restart: unless-stopped

  interactive-backend:
    build:
      context: ./backend
      dockerfile: Dockerfile.interactive
    image: codeguard-interactive-backend
    command: ["node", "src/interactiveserver.js"]
    ports:
      - "5001:5001"
    expose:
      - "5001"
    env_file:
      - .env
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./workspace:/app/workspace
    user: root
    restart: unless-stopped
     

  python-runtime:
    build:
      context: ./backend
      dockerfile: Dockerfile.python
    image: codeguard-python
    command: tail -f /dev/null
    restart: unless-stopped

  c-runtime:
    build:
      context: ./backend
      dockerfile: Dockerfile.c
    image: codeguard-c
    command: tail -f /dev/null
    restart: unless-stopped

volumes:
  pgdata: